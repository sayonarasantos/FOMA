---

- name: Change k3s.yaml permissions
  file:
    path: /etc/rancher/k3s/k3s.yaml
    mode: '0644'
  when: master_in_manager == 1

# - name: Create directory .kube
#   file:
#     path: ~{{ ansible_user }}/.kube
#     state: directory
#     owner: "{{ ansible_user }}"
#     mode: "u=rwx,g=rx,o="
#   when: master_in_manager == 0

# - name: Copy config file to user home directory
#   copy:
#     src: /etc/rancher/k3s/k3s.yaml
#     dest: ~{{ ansible_user }}/.kube/config
#     remote_src: yes
#     owner: "{{ ansible_user }}"
#     mode: "u=rw,g=,o="
#     when: master_in_manager == 0


# - name: Replace https://localhost:6443 by https://master-ip:6443
#   command: >-
#     k3s kubectl config set-cluster default
#       --server=https://{{ master_ip }}:6443
#       --kubeconfig ~{{ ansible_user }}/.kube/config
#   changed_when: true
#   when: master_in_manager == 0

# - name: Create kubectl symlink
#   file:
#     src: /usr/local/bin/k3s
#     dest: /usr/local/bin/kubectl
#     state: link
#   when: master_in_manager == 0

# - name: Create crictl symlink
#   file:
#     src: /usr/local/bin/k3s
#     dest: /usr/local/bin/crictl
#     state: link
#   when: master_in_manager == 0
